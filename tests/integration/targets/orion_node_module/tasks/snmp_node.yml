---
- name: Create node (check mode)
  orion_node:
    hostname: "{{ orion_test_solarwinds_server }}"
    username: "{{ orion_test_solarwinds_username }}"
    password: "{{ orion_test_solarwinds_password }}"
    state: present
    name: "{{ orion_test_node_name }}"
    ip_address: "{{ orion_test_node_ip_address }}"
    polling_method: SNMP
    ro_community_string: "{{ orion_test_node_ro_community_string }}"
  delegate_to: localhost
  check_mode: true
  register: snmp_add_01

- name: Create node
  orion_node:
    hostname: "{{ orion_test_solarwinds_server }}"
    username: "{{ orion_test_solarwinds_username }}"
    password: "{{ orion_test_solarwinds_password }}"
    state: present
    name: "{{ orion_test_node_name }}"
    ip_address: "{{ orion_test_node_ip_address }}"
    polling_method: SNMP
    ro_community_string: "{{ orion_test_node_ro_community_string }}"
  delegate_to: localhost
  register: snmp_add_02

- name: Create node (check) (idempotence)
  orion_node:
    hostname: "{{ orion_test_solarwinds_server }}"
    username: "{{ orion_test_solarwinds_username }}"
    password: "{{ orion_test_solarwinds_password }}"
    state: present
    name: "{{ orion_test_node_name }}"
    ip_address: "{{ orion_test_node_ip_address }}"
    polling_method: SNMP
    ro_community_string: "{{ orion_test_node_ro_community_string }}"
  delegate_to: localhost
  check_mode: true
  register: snmp_add_03

- name: Create node (idempotence)
  orion_node:
    hostname: "{{ orion_test_solarwinds_server }}"
    username: "{{ orion_test_solarwinds_username }}"
    password: "{{ orion_test_solarwinds_password }}"
    state: present
    name: "{{ orion_test_node_name }}"
    ip_address: "{{ orion_test_node_ip_address }}"
    polling_method: SNMP
    ro_community_string: "{{ orion_test_node_ro_community_string }}"
  delegate_to: localhost
  register: snmp_add_04

- name: Create node asserts
  ansible.builtin.assert:
    that:
      - snmp_add_01.changed
      - snmp_add_02.changed
      - snmp_add_02.orion_node.caption == orion_test_node_name
      - snmp_add_02.orion_node.ipaddress == orion_test_node_ip_address
      - snmp_add_02.orion_node.objectsubtype == "SNMP"
      - not snmp_add_03.changed
      - not snmp_add_04.changed

- name: Delete node (check)
  orion_node:
    hostname: "{{ orion_test_solarwinds_server }}"
    username: "{{ orion_test_solarwinds_username }}"
    password: "{{ orion_test_solarwinds_password }}"
    state: absent
    name: "{{ orion_test_node_name }}"
  delegate_to: localhost
  check_mode: true
  register: snmp_delete_01

- name: Delete node
  orion_node:
    hostname: "{{ orion_test_solarwinds_server }}"
    username: "{{ orion_test_solarwinds_username }}"
    password: "{{ orion_test_solarwinds_password }}"
    state: absent
    name: "{{ orion_test_node_name }}"
  delegate_to: localhost
  register: snmp_delete_02

- name: Delete node (check) (idempotence)
  orion_node:
    hostname: "{{ orion_test_solarwinds_server }}"
    username: "{{ orion_test_solarwinds_username }}"
    password: "{{ orion_test_solarwinds_password }}"
    state: absent
    name: "{{ orion_test_node_name }}"
  delegate_to: localhost
  check_mode: true
  register: snmp_delete_03

- name: Delete node (idempotence)
  orion_node:
    hostname: "{{ orion_test_solarwinds_server }}"
    username: "{{ orion_test_solarwinds_username }}"
    password: "{{ orion_test_solarwinds_password }}"
    state: absent
    name: "{{ orion_test_node_name }}"
  delegate_to: localhost
  register: snmp_delete_04

- name: Delete node asserts
  ansible.builtin.assert:
    that:
      - snmp_delete_01.changed
      - snmp_delete_02.changed
      - not snmp_delete_03.changed
      - not snmp_delete_04.changed
...
